{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE AllowAmbiguousTypes #-}

daml 1.2

module Main.Com.Banking.Index.Model where

type IndexKey = (Table, [(Field, Text)])
type IndexValue = Text

class TypeKey a where
    toKey : a -> Text
    fromKey : Text -> a

instance TypeKey Text where
    toKey = identity
    fromKey = identity

data Table
  = Bank
  | Account
  | TransferOrder
    deriving (Eq, Show)

data Field
  = All
  | Name
  | LastName
  | BankId
  | AccountNumber
  | TransferOrderState
    deriving (Eq, Show)

class (Eq id, Template model, TemplateKey model (Party, id)) => IndexKeyConverter model id | id -> model, model -> id where
    idToIndexValue : id -> Optional IndexValue
    indexValueToId : IndexValue -> Optional id
    extractId : model -> id
    id : model -> id
    id = extractId

class IndexedFields a where
    indexes : a -> [IndexKey]

template Record
  with
    owner: Party
    key_: IndexKey
    values: [IndexValue]
  where
    signatory owner

    key (owner, key_): (Party, IndexKey)
    maintainer key._1